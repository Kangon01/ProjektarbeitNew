/**
 * Created by alin_balasa on 12-May-16.
 */

console.log("●● expand.js");
	
var selectors = {
    /* Selectors for the nodes that will contain an expand/collapse button. */
    "expand_buttons":[
    /* Table caption */
    /* "table > caption", */
    /* Article title */
    ".topic > .title",
    /* Section title. Exclude task labels generated by DITA-OT (EXM-37958 & EXM-38501).*/
    ".sectiontitle:not(.tasklabel)",
    /* Index terms groups */
    ".wh_term_group > .wh_first_letter"]
};

/**
 * Add expand-collapse support.
 */
$(document).ready(function () {
    /* Add the expand/collapse buttons. */
    selectors.expand_buttons.forEach(
    function (selector) {
        var matchedNodes = $(document).find(selector);
        // Add the expand/collapse support only if the title node has visible siblings.
        var visibleSiblings = matchedNodes.siblings(':not(:hidden)');// 所有不隐藏的兄弟
        if (visibleSiblings.length > 0) {
            // Add the element with expand/collapse capabilities
            matchedNodes.prepend("<span class=\"wh_expand_btn expanded\"/>");
            markHiddenSiblingsAsNotExpandable(matchedNodes);
        }
    });
    /* Expand / collapse support for the marked content */
    $(document).find('.wh_expand_btn').click(function (event) {
        
        // Change the button state
        $(this).toggleClass("expanded");
        // Will expand-collapse the siblings of the parent node, excepting the ones that were marked otherwise
        var siblings = $(this).parent().siblings(':not(.wh_not_expandable)');
        var tagName = $(this).prop("tagName");
        if (tagName == "CAPTION") {
            // The table does not have display:block, so it will not slide.
            // In this case we'll just hide it
            siblings.toggle();
        } else {
            siblings.slideToggle("500"); //1000毫秒
        }
        event.stopImmediatePropagation();
        return false;
    });
	/*  点击标题 */
	$(document).find('h2.title, h3.title, h4.title').click(function (event) {
		// 内部的 wh_expand_btn
		var expandBtn = $(this).find('.wh_expand_btn');
		// Change the button state
		$(expandBtn).toggleClass("expanded");
		// Will expand-collapse the siblings of the parent node, excepting the ones that were marked otherwise
        var siblings = $(expandBtn).parent().siblings(':not(.wh_not_expandable)');
        var tagName = $(expandBtn).prop("tagName");
        if (tagName == "CAPTION") {
            // The table does not have display:block, so it will not slide.
            // In this case we'll just hide it
            siblings.toggle();
        } else {
            siblings.slideToggle("500"); //1000毫秒
        }
        event.stopImmediatePropagation();
        return false;
        });
        if ($(window).width() < 768) {
              $('.wh_expand_btn').each(function () {
                     var siblings = $(this).parent().siblings(':not(.wh_not_expandable)');

            // 确保懒加载资源加载
            siblings.find('img[data-src]').each(function () {
                $(this).attr('src', $(this).data('src')); // Replace data-src with src
            });

            // 临时显示隐藏内容以触发加载
            siblings.css({ display: 'block', visibility: 'hidden' });

            // // 确保资源加载后立即隐藏
            setTimeout(() => {
                siblings.css({ display: 'none', visibility: 'visible' });
            }, 600); // 确保短暂时间内加载完成

            // 默认移除 expanded 状态
            $(this).removeClass('expanded');
        });
    }
	/*  PC: 默认收缩  隐藏 */
	/* if ($(window).width() > 768) {
		$('.wh_expand_btn').each(function(){
			$(this).parent().siblings().hide();
			$(this).removeClass('expanded');
		});
	} */
	
});

/**
 * Marks the hidden siblings of the matched nodes as being not expandable.
 *
 * @param nodes The matched nodes.
 */
function markHiddenSiblingsAsNotExpandable(nodes) {
    var siblings = nodes.siblings(":hidden");// 所有隐藏的兄弟
    siblings.addClass("wh_not_expandable");
}

/*added by Tung to add icon*/
$(document).ready(function () {
    var x = document.getElementsByClassName("hd");
    var i;
    for (i = 0; i < x.length; i++) {
        x[i].innerHTML = x[i].innerHTML + "<img src=\"../daksys-webhelp/resources/img/hd.png \" height=\"75\" width=\"75\" />"
    }
    var x = document.getElementsByClassName("water_proof");
    var i;
    for (i = 0; i < x.length; i++) {
        x[i].innerHTML =  x[i].innerHTML + "<img src=\"../daksys-webhelp/resources/img/waterproof.png \" height=\"75\" width=\"75\" />"
    }
    var x = document.getElementsByClassName("H265");
    var i;
    for (i = 0; i < x.length; i++) {
        x[i].innerHTML =  x[i].innerHTML + "<img src=\"../daksys-webhelp/resources/img/h265.png \" height=\"75\" width=\"75\" />"
    }
    var x = document.getElementsByClassName("motorized");
    var i;
    for (i = 0; i < x.length; i++) {
        x[i].innerHTML =  x[i].innerHTML + "<img src=\"../daksys-webhelp/resources/img/motorized.png \" height=\"75\" width=\"75\" />"
    }
    var x = document.getElementsByClassName("WDR");
    var i;
    for (i = 0; i < x.length; i++) {
        x[i].innerHTML =  x[i].innerHTML + "<img src=\"../daksys-webhelp/resources/img/wdr.png \" height=\"75\" width=\"75\" />"
    }
    var x = document.getElementsByClassName("DNR");
    var i;
    for (i = 0; i < x.length; i++) {
        x[i].innerHTML =  x[i].innerHTML + "<img src=\"../daksys-webhelp/resources/img/3ddnr.png \" height=\"75\" width=\"75\" />"
    }
    
/*    This added to move the title*/
    $('.wt_topic_content>h1').each(function() {
        $(this).parent().parent().before(this);
    });
    
    $('#bodywrapper').addClass($('#lang').text());
	$('#content_area').addClass($('#lang').text());
    
});
